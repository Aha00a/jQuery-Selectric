/*! SelEctric Ïž v1.0 | Copyright (c) 2012 Leonardo Santos | Dual licensed under the MIT and GPL licenses */
(function(e,m){function n(c,l){this.element=c;this._name=d;this.options=e.extend({},u,l);/android|ip(hone|od|ad)/i.test(navigator.userAgent)||this.init(this.options)}var d="selectric",u={onOpen:function(){},onClose:function(){},maxHeight:300,keySearchTimeout:500,highlight:!0,arrowButtonMarkup:'<span class="button">&#9660;</span>',disableOnMobile:!0,margin:5,bindSufix:".sl",border:1};n.prototype.init=function(c){function l(){b.prop("disabled")?v.addClass(d+"Disabled"):(v.removeClass(d+"Disabled"),b.unbind(z).bind(z,u),k.parent().unbind("click").bind("click"+i,G),b.unbind("focusin").bind("focusin"+i,function(a){!o&&w(a)}),H())}function n(){f.empty();var a=b.find("option"),p="",c=a.filter(":selected").index();a.length&&(a.each(function(d){for(var b=e(this),f="",h=g,j=b.val(),k=b.text(),b=b.text(),i=A.length;i--;)b=b.toLowerCase().replace(A[i],I[i]);h[d]={value:j,text:k,slug:b};d===c&&(g.selected=d,f="selected");a.length-1===d&&(f+=" last");p+='<li class="'+f+'" data-value="'+g[d].value+'">'+g[d].text+"</li>"}),f.append(p),k.text(g[g.selected].text))}function u(a){a.preventDefault();var b=g.selected,c=g.length;switch(a.keyCode){case 38:case 37:q(0===b?c-1:b-1);break;case 40:case 39:q(b<c-1?b+1:0);break;case 13:case 9:case 27:a.stopPropagation(),q(b,!0)}}function H(){f=j.find("ul");r=f.find("li");r.click(function(a){a.stopPropagation();q(e(this).index(),!0)})}function G(a){o?t(a):w(a)}function w(a){a.preventDefault();a.stopPropagation();e("."+d+"Open select")[d]("close");B();o=!0;var p=e(m).scrollTop();"click"===a.type&&b.focus();e(m).scrollTop(p);x.bind("click"+i,t);b.parent().addClass(d+"Open");C(f.find(".selected").index());c.onOpen.call(this)}function B(){var a=x.height();h.show().css("top","");h.top+h.height()>a||v.offset().top+f.parent().height()>e(m).scrollTop()+e(m).height()?(h.css("top",-f.parent().height()),0>h.offset().top-h.height()&&j.offset().top<c.maxHeight&&h.height(j.offset().top-c.margin).css("top",-f.parent().height())):y()}function t(){h.hide();b.blur().change().parent().removeClass(d+"Open");o=!1;D&&k.html(k.text());x.unbind(i);c.onClose.call(b)}function q(a,c){r.removeClass("selected").eq(a).addClass("selected");b.val(g[a].value).find("option").eq(a).prop("selected",!0);C(a);g.selected=a;k.text(g[a].text);c&&t()}function C(a){var b=r[a].offsetTop,a=r.eq(a).outerHeight(),c=f.parent().scrollTop(),d=f.parent().height(),e=b+2*a;e>c+d?f.parent().scrollTop(e-d):b-a<c&&f.parent().scrollTop(b-a)}function y(){h.height()>c.maxHeight&&h.height(c.maxHeight);h.width(j.outerWidth()-2*c.border)}var j=e('<div class="'+d+'"><p class="label"></p>'+c.arrowButtonMarkup+'</div><div class="'+d+'Items"><ul></ul></div>'),E=this.element,b=e(E),g=[],o=!1,k=j.find(".label"),f=j.find("ul"),r,h=j.find("ul").parent(),i=/^\./.test(c.bindSufix)?c.bindSufix:"."+c.bindSufix,x=e(document),v=b.wrap('<div class="'+d+'Wrapper"/>').parent().addClass(E.className).bind("mouseenter mouseleave",function(){e(this).toggleClass("hover")}),z=e.browser.mozilla?"keypress"+i:"keydown"+i,I="aeiouncy".split(""),A=[/[\340-\346]/g,/[\350-\353]/g,/[\354-\357]/g,/[\362-\370]/g,/[\371-\374]/g,/[\361]/g,/[\347]/g,/[\377]/g];b.data(d,this);n();l();var s="",F,D=c.highlight;b.bind("keydown",function(a){a=a.keyCode||a.which;clearTimeout(F);if(~e.inArray(a,[37,38,39,40]))s="";else{s+=String.fromCharCode(a);for(var a=RegExp("^("+s+")","i"),b=0,d=g.length;b<d;b++)if(a.test(g[b].slug)||a.test(g[b].text)){q(b);D&&k.html(k.text().replace(a,"<span>$1</span>"));break}F=setTimeout(function(){s=""},c.keySearchTimeout)}});e(m).scroll(function(){o&&B()});b.parent().append(j);y();b.bind("refresh",function(){n();y();l()}).bind("destroy",function(){h.remove();j.remove();b.unwrap("."+d+"Wrapper").removeData(d).unbind(i+" refresh destroy open close")}).bind("open",w).bind("close",t)};e.fn[d]=function(c,l){return this.each(function(){e.data(this,d)?"string"===typeof c&&e(this).trigger(c):new n(this,c?c:l)})}})(jQuery,window);