/*! SelEctric ÏŸ v1.2 | Copyright (c) 2012 Leonardo Santos | Dual licensed under the MIT and GPL licenses */
(function(g,I){function m(d,b){this.element=d;this.options=g.extend({},u,b);/android|ip(hone|od|ad)/i.test(navigator.userAgent)||this.init(this.options)}var b="selectric",u={onOpen:function(){},onClose:function(){},maxHeight:300,keySearchTimeout:500,highlight:!0,arrowButtonMarkup:'<span class="button">&#9660;</span>',disableOnMobile:!0,margin:5,bindSufix:".sl",border:1};m.prototype.init=function(d){function r(){c.prop("disabled")?v.addClass(b+"Disabled"):(v.removeClass(b+"Disabled"),c.unbind(A).bind(A,u),l.parent().unbind("click").bind("click"+i,J),c.unbind("focusin").bind("focusin"+i,function(a){!n&&w(a)}),K())}function m(){h.empty();var a=c.find("option"),j="",d=a.filter(":selected").index();a.length&&(a.each(function(b){for(var c=g(this),e="",h=f,k=c.val(),l=c.text(),c=c.text(),i=B.length;i--;)c=c.toLowerCase().replace(B[i],L[i]);h[b]={value:k,text:l,slug:c};b===d&&(f.selected=b,e="selected");a.length-1===b&&(e+=" last");j+='<li class="'+e+'" data-value="'+f[b].value+'">'+f[b].text+"</li>"}),h.append(j),l.text(f[f.selected].text))}function u(a){a[C]();var j=f.selected,b=f.length,c=a.keyCode;/3(7|8)/.test(c)&&o(0===j?b-1:j-1);/39|40/.test(c)&&o(j<b-1?j+1:0);/9|13|27/.test(c)&&(a[x](),o(j,!0))}function K(){h=k.find("ul");s=h.find("li").click(function(a){a[x]();o(g(this).index(),!0)})}function J(a){n?t(a):w(a)}function w(a){a[C]();a[x]();g("."+b+"Open select")[b]("close");D();n=!0;var j=p.scrollTop();"click"===a.type&&c.focus();p.scrollTop(j);y.bind("click"+i,t);c.parent().addClass(b+"Open");E(h.find(".selected").index());d.onOpen.call(this)}function D(){var a=y.height();e.show().css("top","");e.top+e.height()>a||v.offset().top+h.parent().height()>p.scrollTop()+p.height()?(e.css("top",-h.parent().height()),0>e.offset().top-e.height()&&k.offset().top<d.maxHeight&&e.height(k.offset().top-d.margin).css("top",-h.parent().height())):z()}function t(){e.hide();c.blur().change().parent().removeClass(b+"Open");n=!1;F&&l.html(l.text());y.unbind(i);d.onClose.call(c)}function o(a,b){s.removeClass("selected").eq(a).addClass("selected");c.val(f[a].value).find("option").eq(a).prop("selected",!0);E(a);f.selected=a;l.text(f[a].text);b&&t()}function E(a){var b=h.parent(),c=s[a].offsetTop,a=s.eq(a).outerHeight(),d=b.scrollTop(),e=b.height(),f=c+2*a;f>d+e?b.scrollTop(f-e):c-a<d&&b.scrollTop(c-a)}function z(){e.height()>d.maxHeight&&e.height(d.maxHeight);e.width(k.outerWidth()-2*d.border)}var k=g('<div class="'+b+'"><p class="label"></p>'+d.arrowButtonMarkup+'</div><div class="'+b+'Items"><ul></ul></div>'),G=this.element,c=g(G),f=[],n=!1,l=k.find(".label"),h=k.find("ul"),s,e=h.parent(),i=("."+d.bindSufix).replace(/^\.+/g,"."),y=g(document),p=g(I),v=c.wrap('<div class="'+b+'Wrapper"/>').parent().addClass(G.className).bind("hover",function(){g(this).toggleClass("hover")}),A=g.browser.mozilla?"keypress"+i:"keydown"+i,L="aeiouncy".split(""),B=[/[\340-\346]/g,/[\350-\353]/g,/[\354-\357]/g,/[\362-\370]/g,/[\371-\374]/g,/[\361]/g,/[\347]/g,/[\377]/g],q="",H,F=d.highlight,C="preventDefault",x="stopPropagation";c.data(b,this);m();r();c.bind("keydown",function(a){a=a.keyCode||a.which;clearTimeout(H);if(/3(7|8|9)|40/.test(a))q="";else{q+=String.fromCharCode(a);for(var a=RegExp("^("+q+")","i"),b=0,c=f.length;b<c;){if(a.test(f[b].slug)||a.test(f[b].text)){o(b);F&&l.html(l.text().replace(a,"<span>$1</span>"));break}b++}H=setTimeout(function(){q=""},d.keySearchTimeout)}});p.scroll(function(){n&&D()});c.parent().append(k);z();c.bind("refresh",function(){m();z();r()}).bind("destroy",function(){e.remove();k.remove();c.unwrap("."+b+"Wrapper").removeData(b).unbind(i+" refresh destroy open close")}).bind("open",w).bind("close",t)};g.fn[b]=function(d,r){return this.each(function(){g.data(this,b)?"string"===typeof d&&g(this).trigger(d):new m(this,d?d:r)})}})(jQuery,window);