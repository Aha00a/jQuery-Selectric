/*! SelEctric Ïž v1.0 | Copyright (c) 2012 Leonardo Santos | Dual licensed under the MIT and GPL licenses */
(function(e,m){function n(c,l){this.element=c;this._name=d;this.options=e.extend({},u,l);/android|ip(hone|od|ad)/i.test(navigator.userAgent)||this.init(this.options)}var d="selectric",u={onOpen:function(){},onClose:function(){},maxHeight:300,keySearchTimeout:500,highlight:!0,arrowButtonMarkup:'<span class="button">&#9660;</span>',disableOnMobile:!0,margin:5,bindSufix:".sl",border:1};n.prototype.init=function(c){function l(){b.prop("disabled")?v.addClass(d+"Disabled"):(v.removeClass(d+"Disabled"),b.unbind(A).bind(A,u),j.parent().unbind("click").bind("click"+k,H),b.unbind("focusin").bind("focusin"+k,function(a){!o&&w(a)}),I())}function n(){f.empty();var a=b.find("option"),p="",c=a.filter(":selected").index();a.length&&(a.each(function(d){for(var b=e(this),f="",h=g,i=b.val(),j=b.text(),b=b.text();x--;)b=b.toLowerCase().replace(B[x],J[x]);h[d]={value:i,text:j,slug:b};d===c&&(g.selected=d,f="selected");a.length-1===d&&(f+=" last");p+='<li class="'+f+'" data-value="'+g[d].value+'">'+g[d].text+"</li>"}),f.append(p),j.text(g[g.selected].text))}function u(a){a.preventDefault();var b=g.selected,c=g.length;switch(a.keyCode){case 38:case 37:q(0===b?c-1:b-1);break;case 40:case 39:q(b<c-1?b+1:0);break;case 13:case 9:case 27:a.stopPropagation(),q(b,!0)}}function I(){f=i.find("ul");r=f.find("li");r.click(function(a){a.stopPropagation();q(e(this).index(),!0)})}function H(a){o?t(a):w(a)}function w(a){a.preventDefault();a.stopPropagation();e("."+d+"Open select")[d]("close");C();o=!0;var p=e(m).scrollTop();"click"===a.type&&b.focus();e(m).scrollTop(p);y.bind("click"+k,t);b.parent().addClass(d+"Open");D(f.find(".selected").index());c.onOpen.call(this)}function C(){var a=y.height();h.show().css("top","");h.top+h.height()>a||v.offset().top+f.parent().height()>e(m).scrollTop()+e(m).height()?(h.css("top",-f.parent().height()),0>h.offset().top-h.height()&&i.offset().top<c.maxHeight&&h.height(i.offset().top-c.margin).css("top",-f.parent().height())):z()}function t(){h.hide();b.blur().change().parent().removeClass(d+"Open");o=!1;E&&j.html(j.text());y.unbind(k);c.onClose.call(b)}function q(a,c){r.removeClass("selected").eq(a).addClass("selected");b.val(g[a].value).find("option").eq(a).prop("selected",!0);D(a);g.selected=a;j.text(g[a].text);c&&t()}function D(a){var b=r[a].offsetTop,a=r.eq(a).outerHeight(),c=f.parent().scrollTop(),d=f.parent().height(),e=b+2*a;e>c+d?f.parent().scrollTop(e-d):b-a<c&&f.parent().scrollTop(b-a)}function z(){h.height()>c.maxHeight&&h.height(c.maxHeight);h.width(i.outerWidth()-2*c.border)}var i=e('<div class="'+d+'"><p class="label"></p>'+c.arrowButtonMarkup+'</div><div class="'+d+'Items"><ul></ul></div>'),F=this.element,b=e(F),g=[],o=!1,j=i.find(".label"),f=i.find("ul"),r,h=i.find("ul").parent(),k=/^\./.test(c.bindSufix)?c.bindSufix:"."+c.bindSufix,y=e(document),v=b.wrap('<div class="'+d+'Wrapper"/>').parent().addClass(F.className).bind("mouseenter mouseleave",function(){e(this).toggleClass("hover")}),A=e.browser.mozilla?"keypress"+k:"keydown"+k;b.data(d,this);n();l();var s="",G,E=c.highlight;b.bind("keydown",function(a){a=a.keyCode||a.which;clearTimeout(G);if(~e.inArray(a,[37,38,39,40]))s="";else{s+=String.fromCharCode(a);for(var a=RegExp("^("+s+")","i"),b=0;b<g.length;b++)if(a.test(g[b].slug)||a.test(g[b].text)){q(b);E&&j.html(j.text().replace(a,"<span>$1</span>"));break}G=setTimeout(function(){s=""},c.keySearchTimeout)}});e(m).scroll(function(){o&&C()});var J="a,e,i,o,u,n,c,y".split(","),B=[/[\340-\346]/g,/[\350-\353]/g,/[\354-\357]/g,/[\362-\370]/g,/[\371-\374]/g,/[\361]/g,/[\347]/g,/[\377]/g],x=B.length;b.parent().append(i);z();b.bind("refresh",function(){n();z();l()}).bind("destroy",function(){h.remove();i.remove();b.unwrap("."+d+"Wrapper").removeData(d).unbind(k+" refresh destroy open close")}).bind("open",w).bind("close",t)};e.fn[d]=function(c,l){return this.each(function(){e.data(this,d)?"string"===typeof c&&e(this).trigger(c):new n(this,c?c:l)})}})(jQuery,window);