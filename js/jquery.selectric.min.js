/*! SelEctric ÏŸ v1.3 | Copyright (c) 2012 Leonardo Santos | Dual licensed under the MIT and GPL licenses */
(function(g,G){function l(d,b){this.element=d;this.options=g.extend({},u,b);/android|ip(hone|od|ad)/i.test(navigator.userAgent)||this.init(this.options)}var b="selectric",u={onOpen:function(){},onClose:function(){},maxHeight:300,keySearchTimeout:500,highlight:!0,arrowButtonMarkup:'<span class="button">&#9660;</span>',disableOnMobile:!0,margin:5,bindSufix:".sl",border:1};l.prototype.init=function(d){function r(){c.prop("disabled")?v.addClass(b+"Disabled"):(v.removeClass(b+"Disabled"),c.unbind(z).bind(z,u),k.parent().unbind("click").bind("click"+i,H),c.unbind("focusin").bind("focusin"+i,function(a){!m&&w(a)}),I(),c.parent().append(j),c.wrap('<div class="'+b+'HideSelect" />'))}function l(){h.empty();var a=c.find("option"),n="",d=a.filter(":selected").index();a.length&&(a.each(function(b){for(var c=g(this),e="",h=f,j=c.val(),k=c.text(),c=c.text(),i=A.length;i--;)c=c.toLowerCase().replace(A[i],J[i]);h[b]={value:j,text:k,slug:c};b===d&&(f.selected=b,e="selected");a.length-1===b&&(e+=" last");n+='<li class="'+e+'" data-value="'+f[b].value+'">'+f[b].text+"</li>"}),h.append(n),k.text(f[f.selected].text))}function u(a){a.preventDefault();var b=f.selected,c=f.length,d=a.keyCode;/^3(7|8)$/.test(d)&&o(0===b?c-1:b-1);/^(39|40)$/.test(d)&&o(b<c-1?b+1:0);/^(9|13|27)$/.test(d)&&(a.stopPropagation(),o(b,!0))}function I(){h=j.find("ul");s=h.find("li").click(function(a){a.stopPropagation();o(g(this).index(),!0)})}function H(a){m?t(a):w(a)}function w(a){a.preventDefault();a.stopPropagation();g("."+b+"Open select")[b]("close");B();m=!0;var n=p.scrollTop();"click"===a.type&&c.focus();p.scrollTop(n);x.bind("click"+i,t);c.parent().addClass(b+"Open");C(h.find(".selected").index());d.onOpen.call(this)}function B(){var a=x.height();e.show().css("top","");e.top+e.height()>a||v.offset().top+h.parent().height()>p.scrollTop()+p.height()?(e.css("top",-h.parent().height()),0>e.offset().top-e.height()&&j.offset().top<d.maxHeight&&e.height(j.offset().top-d.margin).css("top",-h.parent().height())):y()}function t(){e.hide();c.blur().change().parent().removeClass(b+"Open");m=!1;D&&k.html(k.text());x.unbind(i);d.onClose.call(c)}function o(a,b){s.removeClass("selected").eq(a).addClass("selected");c.val(f[a].value).find("option").eq(a).prop("selected",!0);C(a);f.selected=a;k.text(f[a].text);b&&t()}function C(a){var b=h.parent(),c=s[a].offsetTop,a=s.eq(a).outerHeight(),d=b.scrollTop(),e=b.height(),f=c+2*a;f>d+e?b.scrollTop(f-e):c-a<d&&b.scrollTop(c-a)}function y(){e.height()>d.maxHeight&&e.height(d.maxHeight);e.width(j.outerWidth()-2*d.border)}var j=g('<div class="'+b+'"><p class="label"/>'+d.arrowButtonMarkup+'</div><div class="'+b+'Items"><ul/></div>'),E=this.element,c=g(E),f=[],m=!1,k=j.find(".label"),h=j.find("ul"),s,e=h.parent(),i=("."+d.bindSufix).replace(/^\.+/g,"."),x=g(document),p=g(G),v=c.wrap('<div class="'+b+'Wrapper"/>').parent().addClass(E.className).bind("hover",function(){g(this).toggleClass("hover")}),z=g.browser.mozilla?"keypress"+i:"keydown"+i,J="aeiouncy".split(""),A=[/[\340-\346]/g,/[\350-\353]/g,/[\354-\357]/g,/[\362-\370]/g,/[\371-\374]/g,/[\361]/g,/[\347]/g,/[\377]/g],q="",F,D=d.highlight;c.data(b,this);l();r();c.bind("keydown",function(a){a=a.keyCode||a.which;clearTimeout(F);if(/^(3(7|8|9)|40)$/.test(a))q="";else{q+=String.fromCharCode(a);for(var a=RegExp("^("+q+")","i"),b=0,c=f.length;b<c;){if(a.test(f[b].slug)||a.test(f[b].text)){o(b);D&&k.html(k.text().replace(a,"<span>$1</span>"));break}b++}F=setTimeout(function(){q=""},d.keySearchTimeout)}});p.scroll(function(){m&&B()});y();c.bind("refresh",function(){l();y();r()}).bind("destroy",function(){e.remove();j.remove();c.unwrap("."+b+"Wrapper").removeData(b).unbind(i+" refresh destroy open close")}).bind("open",w).bind("close",t)};g.fn[b]=function(d,r){return this.each(function(){g.data(this,b)?"string"===typeof d&&g(this).trigger(d):new l(this,d?d:r)})}})(jQuery,window);