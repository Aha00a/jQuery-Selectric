/*! SelEctric ÏŸ v1.4.1 | Copyright (c) 2012 Leonardo Santos | Dual licensed under the MIT and GPL licenses */
(function(g,G){function l(d,b){this.element=d;this.options=g.extend({},v,b);/android|ip(hone|od|ad)/i.test(navigator.userAgent)||this.init(this.options)}var b="selectric",v={onOpen:function(){},onClose:function(){},maxHeight:300,keySearchTimeout:500,highlight:!0,arrowButtonMarkup:'<span class="button">&#9660;</span>',disableOnMobile:!0,margin:5,bindSufix:".sl",border:1};l.prototype.init=function(d){function s(){j.parent().unbind("click");c.unbind(z).unbind("focusin");c.prop("disabled")?m.addClass(b+"Disabled"):(m.removeClass(b+"Disabled"),c.bind(z,v),j.parent().bind("click"+i,H),c.bind("focusin"+i,function(a){!n&&w(a)}),h=k.find("ul"),t=h.find("li").click(function(a){a.stopPropagation();o(g(this).index(),!0)}));c.parent().append(k);c.wrap('<div class="'+b+'HideSelect" />')}function l(){h.empty();var a=c.find("option"),p="",d=a.filter(":selected").index();a.length&&(a.each(function(b){for(var c=g(this),e="",h=f,j=c.val(),k=c.text(),c=c.text(),i=A.length;i--;)c=c.toLowerCase().replace(A[i],I[i]);h[b]={value:j,text:k,slug:c};b===d&&(f.selected=b,e="selected");a.length-1===b&&(e+=" last");p+='<li class="'+e+'" data-value="'+f[b].value+'">'+f[b].text+"</li>"}),h.append(p),j.text(f[f.selected].text))}function v(a){a.preventDefault();var b=f.selected,c=f.length,d=a.keyCode;/^3(7|8)$/.test(d)&&o(0===b?c-1:b-1);/^(39|40)$/.test(d)&&o(b<c-1?b+1:0);/^(9|13|27)$/.test(d)&&(a.stopPropagation(),o(b,!0))}function H(a){n?u(a):w(a)}function w(a){a.preventDefault();a.stopPropagation();g("."+b+"Open select")[b]("close");B();n=!0;var p=q.scrollTop();"click"===a.type&&c.focus();q.scrollTop(p);x.bind("click"+i,u);m.addClass(b+"Open");C(h.find(".selected").index());d.onOpen.call(this)}function B(){var a=x.height();e.show().css("top","");e.top+e.height()>a||m.offset().top+h.parent().height()>q.scrollTop()+q.height()?(e.css("top",-h.parent().height()),0>e.offset().top-e.height()&&k.offset().top<d.maxHeight&&e.height(k.offset().top-d.margin).css("top",-h.parent().height())):y()}function u(){e.hide();c.blur().change();m.removeClass(b+"Open");n=!1;D&&j.html(j.text());x.unbind(i);d.onClose.call(c)}function o(a,b){t.removeClass("selected").eq(a).addClass("selected");c.val(f[a].value).find("option").eq(a).prop("selected",!0);C(a);f.selected=a;j.text(f[a].text);b&&u()}function C(a){var b=h.parent(),c=t[a].offsetTop,a=t.eq(a).outerHeight(),d=b.scrollTop(),e=b.height(),f=c+2*a;f>d+e?b.scrollTop(f-e):c-a<d&&b.scrollTop(c-a)}function y(){e.height()>d.maxHeight&&e.height(d.maxHeight);e.width(k.outerWidth()-2*d.border)}var k=g('<div class="'+b+'"><p class="label"/>'+d.arrowButtonMarkup+'</div><div class="'+b+'Items"><ul/></div>'),E=this.element,c=g(E),f=[],n=!1,j=k.find(".label"),h=k.find("ul"),t,e=h.parent(),i=("."+d.bindSufix).replace(/^\.+/g,"."),x=g(document),q=g(G),m=c.wrap('<div class="'+b+'Wrapper"/>').parent().addClass(E.className).bind("hover",function(){g(this).toggleClass("hover")}),z=g.browser.mozilla?"keypress"+i:"keydown"+i,I="aeiouncy".split(""),A=[/[\340-\346]/g,/[\350-\353]/g,/[\354-\357]/g,/[\362-\370]/g,/[\371-\374]/g,/[\361]/g,/[\347]/g,/[\377]/g],r="",F,D=d.highlight;c.data(b,this);l();s();c.bind("keydown",function(a){a=a.keyCode||a.which;clearTimeout(F);if(/^(3(7|8|9)|40)$/.test(a))r="";else{r+=String.fromCharCode(a);for(var a=RegExp("^("+r+")","i"),b=0,c=f.length;b<c;){if(a.test(f[b].slug)||a.test(f[b].text)){o(b);D&&j.html(j.text().replace(a,"<span>$1</span>"));break}b++}F=setTimeout(function(){r=""},d.keySearchTimeout)}});q.scroll(function(){n&&B()});y();c.bind("refresh",function(){l();y();s()}).bind("destroy",function(){e.remove();k.remove();c.unwrap("."+b+"Wrapper").removeData(b).unbind(i+" refresh destroy open close")}).bind("open",w).bind("close",u)};g.fn[b]=function(d,s){return this.each(function(){g.data(this,b)?"string"===typeof d&&g(this).trigger(d):new l(this,d?d:s)})}})(jQuery,window);