/*! SelEctric ÏŸ v1.4.2 | Copyright (c) 2012 Leonardo Santos | Dual licensed under the MIT and GPL licenses */
(function(g,H){function m(d,b){this.element=d;this.options=g.extend({},w,b);/android|ip(hone|od|ad)/i.test(navigator.userAgent)||this.init(this.options)}var b="selectric",w={onOpen:function(){},onClose:function(){},maxHeight:300,keySearchTimeout:500,highlight:!0,arrowButtonMarkup:'<span class="button">&#9660;</span>',disableOnMobile:!0,margin:5,bindSufix:".sl",border:1};m.prototype.init=function(d){function t(){i.parent().unbind("click");c.unbind(A).unbind("focusin");l.removeClass().addClass(b+"Wrapper "+B.className);c.prop("disabled")?l.addClass(b+"Disabled"):(l.removeClass(b+"Disabled"),c.bind(A,w),i.parent().bind("click"+j,I),c.bind("focusin"+j,function(a){!n&&x(a)}),h=k.find("ul"),u=h.find("li").click(function(a){a.stopPropagation();p(g(this).index(),!0)}))}function m(){h.empty();var a=c.find("option"),q="",d=a.filter(":selected").index();a.length&&(a.each(function(b){for(var c=g(this),e="",h=f,i=c.val(),k=c.text(),c=c.text(),j=C.length;j--;)c=c.toLowerCase().replace(C[j],J[j]);h[b]={value:i,text:k,slug:c};b===d&&(f.selected=b,e="selected");a.length-1===b&&(e+=" last");q+='<li class="'+e+'" data-value="'+f[b].value+'">'+f[b].text+"</li>"}),h.append(q),i.text(f[f.selected].text))}function w(a){a.preventDefault();var b=f.selected,c=f.length,d=a.keyCode;/^3(7|8)$/.test(d)&&p(0===b?c-1:b-1);/^(39|40)$/.test(d)&&p(b<c-1?b+1:0);/^(9|13|27)$/.test(d)&&(a.stopPropagation(),p(b,!0))}function I(a){n?v(a):x(a)}function x(a){a.preventDefault();a.stopPropagation();g("."+b+"Open select")[b]("close");D();n=!0;var q=r.scrollTop();"click"===a.type&&c.focus();r.scrollTop(q);y.bind("click"+j,v);l.addClass(b+"Open");E(h.find(".selected").index());d.onOpen.call(this)}function D(){var a=y.height();e.show().css("top","");e.top+e.height()>a||l.offset().top+h.parent().height()>r.scrollTop()+r.height()?(e.css("top",-h.parent().height()),0>e.offset().top-e.height()&&k.offset().top<d.maxHeight&&e.height(k.offset().top-d.margin).css("top",-h.parent().height())):z()}function v(){var a=f[f.selected].text;e.hide();c.blur();a!=i.text()&&c.change();i.text(a);l.removeClass(b+"Open");n=!1;F&&i.html(i.text());y.unbind(j);d.onClose.call(c)}function p(a,b){u.removeClass("selected").eq(a).addClass("selected");c.val(f[a].value).find("option").eq(a).prop("selected",!0);E(a);f.selected=a;b&&v()}function E(a){var b=h.parent(),c=u[a].offsetTop,a=u.eq(a).outerHeight(),d=b.scrollTop(),e=b.height(),f=c+2*a;f>d+e?b.scrollTop(f-e):c-a<d&&b.scrollTop(c-a)}function z(){e.height()>d.maxHeight&&e.height(d.maxHeight);e.width(k.outerWidth()-2*d.border)}var k=g('<div class="'+b+'"><p class="label"/>'+d.arrowButtonMarkup+'</div><div class="'+b+'Items"><ul/></div>'),B=this.element,c=g(B),f=[],n=!1,i=k.find(".label"),h=k.find("ul"),u,e=h.parent(),j=("."+d.bindSufix).replace(/^\.+/g,"."),y=g(document),r=g(H),l=c.wrap("<div/>").parent().hover(function(){g(this).toggleClass("hover")}),A=g.browser.mozilla?"keypress"+j:"keydown"+j,J="aeiouncy".split(""),C=[/[\340-\346]/g,/[\350-\353]/g,/[\354-\357]/g,/[\362-\370]/g,/[\371-\374]/g,/[\361]/g,/[\347]/g,/[\377]/g],s="",G,F=d.highlight;c.data(b,this).parent().append(k);c.wrap('<div class="'+b+'HideSelect" />');m();t();c.bind("keydown",function(a){a=a.keyCode||a.which;clearTimeout(G);if(/^(3(7|8|9)|40)$/.test(a))s="";else{s+=String.fromCharCode(a);for(var a=RegExp("^("+s+")","i"),b=0,c=f.length;b<c;){if(a.test(f[b].slug)||a.test(f[b].text)){p(b);F&&i.html(i.text().replace(a,"<span>$1</span>"));break}b++}G=setTimeout(function(){s=""},d.keySearchTimeout)}});r.scroll(function(){n&&D()});z();c.bind("refresh",function(){m();z();t()}).bind("destroy",function(){e.remove();k.remove();c.unwrap("."+b+"Wrapper").removeData(b).unbind(j+" refresh destroy open close")}).bind("open",x).bind("close",v)};g.fn[b]=function(d,t){return this.each(function(){g.data(this,b)?"string"===typeof d&&g(this).trigger(d):new m(this,d?d:t)})}})(jQuery,window);